<?xml version="1.0" encoding="UTF-8"?>
<!--
**************************************************************************

Checklist: Before Taxi

Copyright (c) 2015 Richard Senior

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

**************************************************************************
-->

<PropertyList>

  <title>Before Taxi</title>

  <!-- Autopilot - OFF -->
  <item>
    <name>Autopilot</name>
    <value>CHECK</value>
    <condition>
      <and>
        <not>
          <property>autopilot/locks/active</property>
        </not>
        <greater-than>
          <property>autopilot/sperry/pitch-select</property>
          <value>0.0</value>
        </greater-than>
      </and>
    </condition>
    <binding>
      <command>property-assign</command>
      <property>autopilot/locks/active</property>
      <value>0</value>
    </binding>
    <binding>
      <command>property-interpolate</command>
      <property>autopilot/sperry/pitch-select</property>
      <value>5.0</value>
      <time>1.0</time>
    </binding>
  </item>

  <!-- Altimeter - SET -->
  <item>
    <name>Altimeter</name>
    <value>SET</value>
    <condition>
      <less-than>
        <property>instrumentation/altimeter/absolute-altitude-error-ft</property>
        <value>25</value>
      </less-than>
    </condition>
    <binding>
      <command>nasal</command>
      <script>
        var qnh = getprop("environment/metar/pressure-inhg");
        qnh = math.round(qnh * 100) / 100;
        interpolate("instrumentation/altimeter/setting-inhg", qnh, 1.0);
      </script>
    </binding>
  </item>

  <!-- Heading Indicator - SET -->
  <item>
    <name>Heading Indicator</name>
    <value>ALIGN</value>
    <condition>
      <less-than>
        <property>instrumentation/heading-indicator/absolute-heading-error-deg</property>
        <value>5</value>
      </less-than>
    </condition>
    <binding>
      <command>nasal</command>
      <script>
        var h = getprop("orientation/heading-deg");
        var m = getprop("orientation/heading-magnetic-deg");
        var o = getprop("instrumentation/heading-indicator/offset-deg");
        var d = (o > 180) ? int(m - h) + 360 : int(m - h);
        interpolate("instrumentation/heading-indicator/offset-deg", d, 1.0);
      </script>
    </binding>
  </item>

  <!-- Taxi Light - ON -->
  <item>
    <name>Taxi Light</name>
    <value>ON</value>
    <condition>
      <greater-than>
        <property>systems/electrical/outputs/taxi-light</property>
        <value>0</value>
      </greater-than>
    </condition>
    <binding>
      <command>property-assign</command>
      <property>controls/lighting/taxi-light</property>
      <value>1</value>
    </binding>
    <binding>
      <command>nasal</command>
      <script>pup.click();</script>
    </binding>
  </item>

</PropertyList>
